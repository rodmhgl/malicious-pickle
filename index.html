<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Malicious Pickle Gallery</title>
  <style>
    body,
    html {
      height: 100%;
      margin: 0;
      background-color: #000000;
      color: #ffffff;
      font-family: monospace;
      overflow: hidden;
    }

    .container {
      height: 100vh;
      display: flex;
      flex-direction: column;
      justify-content: space-between;
      align-items: center;
      text-align: center;
      padding: 1vh 2vw;
      box-sizing: border-box;
    }

    .upper-content {
      display: flex;
      width: 100%;
      height: 65%;
      max-height: 65vh;
      gap: 2vw;
      align-items: center;
      justify-content: center;
      flex-wrap: wrap;
    }

    .image-container {
      flex: 1;
      min-width: 300px;
      height: 100%;
      display: flex;
      justify-content: center;
      align-items: center;
    }

    #random-image {
      max-width: 100%;
      max-height: 100%;
      border-radius: 8px;
      box-shadow: 0 0 25px rgba(50, 50, 50, 0.3);
      object-fit: contain;
    }

    .info-section {
      flex: 1;
      min-width: 300px;
      max-width: 550px;
      height: 100%;
      display: flex;
      flex-direction: column;
      justify-content: center;
    }

    .info-box {
      width: 100%;
      background-color: rgba(0, 0, 0, 0.7);
      border: 1px solid #2dbd6e;
      border-radius: 8px;
      padding: 15px 25px;
      text-align: left;
      line-height: 1.6;
      box-shadow: 0 0 10px rgba(45, 189, 110, 0.3);
      box-sizing: border-box;
      overflow-y: auto;
      max-height: 80%;
    }

    .blurb-title {
      color: #2dbd6e;
      font-weight: bold;
      font-size: 1.2em;
      margin-bottom: 8px;
    }

    .blurb-content {
      color: #cccccc;
      font-size: 1em;
    }

    .controls {
      margin-top: 2vh;
      margin-bottom: 2vh;
    }

    button {
      background-color: #2dbd6e;
      color: #000000;
      border: none;
      border-radius: 4px;
      padding: 10px 20px;
      font-family: monospace;
      font-size: 1em;
      font-weight: bold;
      cursor: pointer;
      transition: all 0.2s ease;
    }

    button:hover {
      background-color: #22a35f;
      box-shadow: 0 0 10px rgba(45, 189, 110, 0.5);
    }

    /* Terminal console styles */
    .terminal-container {
      width: 100%;
      height: 25vh;
      background-color: #0c0c0c;
      border: 2px solid #2dbd6e;
      border-radius: 6px;
      padding: 0;
      margin-bottom: 1vh;
      overflow: hidden;
      font-family: "Courier New", monospace;
      position: relative;
      box-sizing: border-box;
    }

    .terminal-header {
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      background-color: #2dbd6e;
      color: #000;
      padding: 4px 10px;
      font-weight: bold;
      font-size: 14px;
      display: flex;
      justify-content: space-between;
      z-index: 10;
    }

    .terminal-controls {
      display: flex;
    }

    .terminal-button {
      width: 12px;
      height: 12px;
      border-radius: 50%;
      margin-left: 8px;
      background-color: #000;
      border: 1px solid #000;
    }

    .terminal-content {
      margin-top: 25px;
      height: calc(100% - 25px);
      overflow-y: auto;
      color: #2dbd6e;
      font-size: 14px;
      line-height: 1.3;
      padding: 5px 10px;
      box-sizing: border-box;
    }

    .terminal-line {
      padding: 2px 0;
      display: flex;
    }

    .terminal-prompt {
      color: #2dbd6e;
      margin-right: 8px;
    }

    .terminal-cursor {
      display: inline-block;
      width: 8px;
      height: 15px;
      background-color: #2dbd6e;
      margin-left: 4px;
      animation: blink 1s step-end infinite;
    }

    @keyframes blink {

      0%,
      100% {
        opacity: 1;
      }

      50% {
        opacity: 0;
      }
    }

    /* Responsive adjustments */
    @media (max-width: 768px) {
      .upper-content {
        flex-direction: column;
        height: auto;
        max-height: 65vh;
      }

      .image-container,
      .info-section {
        width: 100%;
        max-width: 100%;
        height: auto;
      }

      .image-container {
        max-height: 35vh;
      }

      .info-section {
        max-height: 28vh;
      }

      .info-box {
        max-height: 100%;
      }

      .terminal-container {
        height: 28vh;
      }
    }

    @media (max-height: 700px) {
      .blurb-title {
        font-size: 1em;
        margin-bottom: 4px;
      }

      .blurb-content {
        font-size: 0.9em;
        line-height: 1.4;
      }

      .terminal-content {
        font-size: 12px;
        line-height: 1.2;
      }
    }
  </style>
</head>

<body>
  <div class="container">
    <div class="upper-content">
      <div class="image-container">
        <img id="random-image" alt="Malicious Pickle">
      </div>

      <div class="info-section">
        <div class="info-box">
          <div class="blurb-title" id="blurb-title">What is a Malicious Pickle?</div>
          <div class="blurb-content" id="blurb-content">
            A "malicious pickle" refers to a Python pickle file containing harmful code. Pickle is Python's
            serialization
            format, but it can execute arbitrary code during deserialization. The first known malicious pickle was
            discovered in January 2022, which used Python's exec function to run a Cobalt Strike stager shellcode
            through
            Windows APIs.
          </div>
        </div>
        <div class="controls">
          <button id="new-pickle-btn">Get Another Pickle</button>
        </div>
      </div>
    </div>

    <!-- Terminal Console -->
    <div class="terminal-container">
      <div class="terminal-header">
        <div>pickle_security.py</div>
        <div class="terminal-controls">
          <div class="terminal-button" style="background-color: #ff5f56;"></div>
          <div class="terminal-button" style="background-color: #ffbd2e;"></div>
          <div class="terminal-button" style="background-color: #27c93f;"></div>
        </div>
      </div>
      <div class="terminal-content" id="terminal-content">
        <!-- Terminal messages will be added here dynamically -->
      </div>
    </div>
  </div>

  <script>
    document.addEventListener('DOMContentLoaded', function () {
      // List of image filenames
      const images = [
        'malicious-pickle.png',
        'malicious-pickle2.png',
        'malicious-pickle3.png',
        'malicious-pickle4.png',
        'malicious-pickle5.png',
        'malicious-pickle6.png',
        'malicious-pickle7.png',
        'malicious-pickle8.png',
        'malicious-pickle9.png',
        'malicious-pickle10.png',
        'malicious-pickle11.png',
        'malicious-pickle12.png',
        'malicious-pickle13.png'
      ];

      let blurbs = [];
      const imgElement = document.getElementById('random-image');

      // Preload images to ensure they're in browser cache
      function preloadImages() {
        images.forEach(imageSrc => {
          const img = new Image();
          img.src = 'images/' + imageSrc;
        });
      }

      // Start preloading images immediately
      preloadImages();

      // Function to set a random image
      function setRandomImage() {
        const randomImage = images[Math.floor(Math.random() * images.length)];
        imgElement.src = 'images/' + randomImage;
      }

      // Set initial random image regardless of blurbs load outcome
      setRandomImage();

      // Attach onload and onerror handlers
      imgElement.onload = function () {
        console.log('Image loaded successfully:', imgElement.src);
      };

      imgElement.onerror = function () {
        console.error('Error loading image:', imgElement.src);
        imgElement.alt = 'Image failed to load';
        // Try reloading the image with a cache-busting parameter
        setTimeout(() => {
          imgElement.src = imgElement.src.split('?')[0] + '?t=' + new Date().getTime();
        }, 500);
      };

      // Function to show random image and blurb
      function showRandomContent() {
        setRandomImage();
        if (blurbs.length > 0) {
          const randomBlurb = blurbs[Math.floor(Math.random() * blurbs.length)];
          document.getElementById('blurb-title').textContent = randomBlurb.title;
          document.getElementById('blurb-content').textContent = randomBlurb.content;
        }
      }

      // Load blurbs from external JSON file
      fetch('blurbs.json')
        .then(response => {
          if (!response.ok) {
            throw new Error('Failed to load blurbs.json');
          }
          return response.json();
        })
        .then(data => {
          blurbs = data;
          // Set a random blurb once the data is loaded
          const randomBlurb = blurbs[Math.floor(Math.random() * blurbs.length)];
          document.getElementById('blurb-title').textContent = randomBlurb.title;
          document.getElementById('blurb-content').textContent = randomBlurb.content;
        })
        .catch(error => {
          console.error('Error loading blurbs:', error);
          // Fallback blurb in case loading fails
          document.getElementById('blurb-title').textContent = 'What is a Malicious Pickle?';
          document.getElementById('blurb-content').textContent =
            'A "malicious pickle" refers to a Python pickle file containing harmful code. ' +
            'Pickle is Python\'s serialization format, but it can execute arbitrary code during deserialization.';
        });

      // Set up button click handler
      document.getElementById('new-pickle-btn').addEventListener('click', showRandomContent);

      // Terminal console functionality
      const terminalMessages = [
        ">>> import pickle",
        ">>> # WARNING: Never unpickle data from untrusted sources",
        ">>> class MaliciousPickle(object):",
        "...     def __reduce__(self):",
        "...         import os",
        "...         return (os.system, ('calc.exe',))",
        "...",
        ">>> # When unpickled, this will execute calc.exe",
        ">>> # The __reduce__ method is what makes pickle dangerous",
        ">>> import pickle",
        ">>> data = pickle.loads(b'...')",
        "ERROR: Insecure string pickle detected",
        ">>> # Safe alternatives: JSON, MessagePack, Protocol Buffers",
        ">>> # Security tip: Validate and sanitize all serialized data",
        ">>> # Security tip: Avoid pickle.loads on untrusted input",
        ">>> # Risk: pickle protocol allows code execution on load",
        ">>> # Vulnerability class: Insecure Deserialization",
        ">>> # Common attack vector: ML model files, config files",
        ">>> # First documented attack: January 2022",
        ">>> # Protect by: validating all serialized data",
        ">>> # Never run: pickle.loads(untrusted_data)",
        ">>> # Risk level: Critical (RCE capability)"
      ];

      const terminalContent = document.getElementById('terminal-content');

      // Function to add a line to the terminal
      function addTerminalLine(text, delay = 100) {
        const line = document.createElement('div');
        line.className = 'terminal-line';

        if (text.startsWith('>>>') || text.startsWith('...')) {
          const prompt = document.createElement('span');
          prompt.className = 'terminal-prompt';
          prompt.textContent = text.substring(0, 4);

          const content = document.createElement('span');
          content.textContent = text.substring(4);

          line.appendChild(prompt);
          line.appendChild(content);
        } else if (text.startsWith('ERROR:')) {
          line.style.color = '#ff5f56';
          line.textContent = text;
        } else {
          line.textContent = text;
        }

        terminalContent.appendChild(line);
        terminalContent.scrollTop = terminalContent.scrollHeight;
      }

      // Display terminal messages with a typing effect
      let currentMessageIndex = 0;

      function displayNextTerminalMessage() {
        if (currentMessageIndex < terminalMessages.length) {
          addTerminalLine(terminalMessages[currentMessageIndex]);
          currentMessageIndex++;

          // Random delay between messages for realistic typing feel
          const delay = Math.random() * 1000 + 500;
          setTimeout(displayNextTerminalMessage, delay);
        } else {
          // Add blinking cursor at the end
          const lastLine = document.createElement('div');
          lastLine.className = 'terminal-line';

          const prompt = document.createElement('span');
          prompt.className = 'terminal-prompt';
          prompt.textContent = '>>> ';

          const cursor = document.createElement('span');
          cursor.className = 'terminal-cursor';

          lastLine.appendChild(prompt);
          lastLine.appendChild(cursor);
          terminalContent.appendChild(lastLine);
        }
      }

      // Start displaying terminal messages after a short delay
      setTimeout(displayNextTerminalMessage, 1000);
    });
  </script>
</body>

</html>